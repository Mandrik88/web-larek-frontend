# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Данные о товаре
export interface IProduct {
id: string;
description: string;
image: string;
title: string;
category: string;
price: number | null;
}

Данные о пользователе
export interface IUser {
paiment?: string;
adress?: string;
email?: string;
phone?: string;
}

модель для хранения товаров в каталоге
export interface IProductData {
counter: number
catalog: IProduct[]
}

корзина с ID товаров из каталога и суммой заказа

export interface IOrder {
totalamount: number
productListItem: IProduct['id'][]
}

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Основные события, которые генерируются в приложении: 
- card: select - событие, которое инициируется при клике на конкретный товар из каталога, что ведет за собой открытие модального окна с подробной инфроацией о товаре
- items: change - событие, которое инициируется при изменении списка товаров на странице, что ведет за собой перерисовку списка товаров на странице (оверлэй)
- card: toBasket - событие, которое инициируется по клику на кнопку "В корзину" в карточке товара, что ведест за собой изменение количества товаров в корзине (на значке корзины)
- preview: change - событие, которое инициируется при передаче моделью новых данныз, оповещает слов View бчто ведет к отрисовке содержимого модального окна
- modal: close - событие, котрое инициируется при нажатии на крестик в модальном окне, а также при нажатии на кнопку Esc и при клике вне поля модального окна
- basket: order - событие, которое инициируется при клике по корзине, при этом открывается модальное окно с заказом
- basket: delete - событие, которое инициируется при клике на кнопку удаления позиции в заказе, внутри корзины, как результат меняется списоко позиций заказа
- basket: placeOnOrder - событие, которое инициируется при клике на кнопку "Оформить" в корзине и влечет за собой открытие модального окна с выбором оплаты
- order: online - событие, которое инициируется при клике на кнопку "Онлайн", в модальном окне с выбором способа оплаты
- order: offline - событие, которое инициируется при клике на кнопку "При получении", в модальном окне с выбором способа оплаты
- order: toContacts - событие, которое инициируется при клике на кнопку "Далее", это ведет за соблой открытие модального окна, в котором пользователю нужно заполнить поля со своими конктактными данными
- input: validate - событие, которое инициируется при вводе данных пользовтеля в поля формы, тем самым запуская процесс валидации
- input:error - событие, которое инициируется при вводе данных пользовтеля в поля формы, при этом выполняется проверка формы и возврашаются ошибки
- order: success - событие, которое инициируется при успешном ответе сервера на запрос об оплате, что ведет за собой откртыие модального окнас с соответствуюей формулировкой "Заказ оформлен"

### Слой данных

Класс Product
Этот класс отвечает за хранение и логику работы с данными о товарах, которые выбирает и кладет в корзину пользователь.
В полях класса хранятся следующие данные:

items: IProduct[] - Массив объектов со всеми товарами
order: IUser - Данные о заказе при покупке товара
basket: IProduct[] - Массив объектов товаров в корзине

Список методов для взиамодействия с данными в этом классе:
- addToBasket() - метод добавления товара в корзину
- deleteFromBasket() - метод удаления товара из корзины
- clearBasket() - метод очистки корзины
- getCountsInBasket() - метод получения количества товаров в корзине
- isProductsInBasket() - метод для проверки наличия товаров в корзине
- getProductsInBasket() - метод получения списка ID товаров в корзине
- getAllPrice() - метод получения общей стоимости товаров в корзине
- addProducts() - метод добавления каталога с товарами(массива)
- setPreview() - метод получения превью товара
- fillUserContacts() - метод для заполнения полей с контактными данными пользователя
- validateContacts() - метод валидации формы с полями ввода adreess, email, phone
- validateOrder() - метод валидации формы с заказом
- claerUser() - метод очистки данных о пользователе

Слой представления

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна `render` для отрисовки данных контента. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
 Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents
constructor (container: HTMLElement, protected events: IEvents)

Поля класса

- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

###Класс Cards
Отвечает за отображение карточек в каталоге, при открытии модального окна с карточкой, а также при открытии корзины с каталогом карточек.
Поля отвечают за связь с разметкой, методы реализуют наполнение разметки данными.
Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект action типа ICardAction для установки слушателя на кнопку или контейнер.
constructor (container: HTMLElement, action?: ICardAction)

Поля класса:
\_description - хранит описание карточки
\_image - хранит разметку изображения карточки
\_title - хранит разметку заголовка карточки
\_category - хранит разметку категории карточки
\_price - хранит разметку цены карточки

Методы класса

set description - устанавливает описание карточки
set image - устанавливает изображение карточки
set title - устанавливает заголовок карточки
set price - устанавливает стоимость карточки
set id - устанавливает id карточки
set category - устанавливает категорию карточки

###Класс Basket
Описывает (отображает) корзину с товарами
Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents
constructor (container: HTMLElement, protected events: IEvents)

Поля класса

productListItem — блок для отображения списка карточек товаров
totalElement — хранит разметку cуммы товаров в корзине
button — элемент для перехода к оформлению заказа
Методы класса

set list — устанавливает товары в разметку
set price — устанавливает значение суммы товаров

###Класс Form
Данный класс отвечает за работу форм в приложении. Реализует валидацию данных введенных в форму и контролирует выведение ошибок, возникающих при вводе некорректынх данных.
Конструктор принимает container типа HTMLElement, передавая его в родительский конструктор, а также объект event типа IEvents.

Поля класса:

submitButton — хранит разметку кнопки отправки формы
errorsValidate — хранит разметку вывода ошибок валидации

Методы класса:

onInputChange — регистрирует событие с именем конкретного поля
set valid — метод установки валидности
render — создание и отрисовка формы и ее элементов на странице

###Класс Order
Данный класс отвечает за отображение способа оплаты и адреса доставки в модальном окне. Этот класс расширяет класс Form по интерфейсу IUser. Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents.
constructor (container: HTMLElement, protected events: IEvents)

Поля класса:

- buttonsPay — хранит разметку кнопок формы оплаты

Методы класса:

- set activity — устанавливает класс активности на кнопку
- set address — устанавливает значение поля адрес

###Класс Contacts
Данный класс отвечает за отображение контактов покупателя в соответствующем модальном окне.
Расширяет класс Form по интерфейсу IUser.

Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Методы класса:

- set phone — устанавливает значение поля телефона
- set email — устанавливает значение поля почты

###Класс Success
Данный класс отвечает за отображение успешной покупки.
Рассширяет базовый абстрактный класс Component
Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса:

- all price — разметка общей суммы товаров в заказе

Методы класса:

- set all — установка значения общей суммы

###Класс Page
Данный класс отвечает за отображение данных основных элементов на странице приложения. К таковы относятся: каталог товаров, корзина, счетчик товаров в корзине.Конструктор класса принимает container типа HTMLElement, передавая его в родительский конструктор, а также объект event типа IEvents.
Поля отвечают за связь с разметкой, методы за наполнение разметки данными, а также метод закрытия/открытия для прокрутки страницы при открытии/закрытии модального окна.

Поля класса:

- counterBasket - хранится разметка счетчика товаров в корзине
- productCatalog — хранит разметку каталога товаров
- wrapper — хранит разметку обертки страницы
- buttonBasket — хранит разметку кнопки корзины

Методы класса:

- set counter - отображение счётчика товаров в корзине
- set catalog - отображение карточек товаров на странице
- set locked - устанавливает класс, блокирующий прокрутку страницы

